---
- name: Check whether delta.xml exists
  ansible.windows.win_stat:
    path: 'D:\Siemens\Teamcenter2512\TC_DATA\model\delta.xml'
  register: delta_xml_stat
- name: Display delta.xml existence status
  ansible.builtin.debug:
    var: delta_xml_stat.stat.exists
- name: Proceed to comment XML elements if deployment failed and delta.xml exists
  ansible.builtin.debug:
    msg: "Proceeding to comment XML elements in delta.xml"
  when: delta_xml_stat.stat.exists
- name: Comment specific multi-line XML elements wherever they appear
  ansible.windows.win_shell: |
    $path = 'D:\Siemens\Teamcenter2512\TC_DATA\model\delta.xml'
    $content = Get-Content $path -Raw
    $content = $content -replace '(?<!<!--)\s*(<{{ item }}[\s\S]*?/>)','<!-- $1 -->'
    Set-Content $path $content
  loop:
    - 'TcStandardType typeName="Att0HasConfigurationContext"'
    - 'TcClass className="Att0HasConfigurationContext"'
    - 'TcStatus statusName="ACEDesign"'
    - 'TcStatus statusName="ACEDesignApprove"'
    - 'TcStatus statusName="ACEProduction"'
    - 'TcStatus statusName="ACEProductionApprove"'
    - 'TcStatus statusName="ACEQualityCheck"'
    - 'TcStatus statusName="DMUIn-working"'
    - 'TcStatus statusName="DMUPending"'
    - 'TcStatus statusName="DMUReleased"'
    - 'TcStatus statusName="PSMDesignApproval"'
    - 'TcStatus statusName="PSMDesignStart"'
    - 'TcStatus statusName="PSMProductionApproval"'
    - 'TcStatus statusName="PSMProductionStart"'
    - 'TcStatus statusName="PSMQualityOK"'
